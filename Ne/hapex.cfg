global
    daemon
    log stdout format raw local0 info
    maxconn 4096
    master-worker
    ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
    ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
    ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets

defaults
   timeout connect 5s
   timeout client 1m
   timeout server 1m

frontend frontend-all
  bind *:7698 ssl crt /haproxy.pem
  mode http
  acl is_service1 path_beg /company
  acl is_service2 path_beg /server2
  use_backend backend-service1 if is_service1
  use_backend backend-service2 if is_service2

backend backend-service1
  balance roundrobin
  mode http
  server server1 host.docker.internal:9999 check ssl crt /haproxy.pem verify none

backend backend-service2
  mode http
  balance roundrobin
  server server2-1 host.docker.internal:8443 check ssl crt /haproxy.pem verify none
  server server2-2 host.docker.internal:8543 check ssl crt /haproxy.pem verify none

frontend stats
    bind *:8084
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if LOCALHOST
    stats hide-version
